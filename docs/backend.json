{
  "entities": {
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single chat message within the Forever Us application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the User who sent the message. (Relationship: User 1:N ChatMessage)"
        },
        "content": {
          "type": "string",
          "description": "The text content of the chat message."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time when the message was sent, stored as a string.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "senderId",
        "content",
        "timestamp"
      ]
    },
    "DateNight": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DateNight",
      "type": "object",
      "description": "Represents a date night event scheduled within the Forever Us application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the date night event."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who scheduled the date night. (Relationship: User 1:N DateNight)"
        },
        "date": {
          "type": "string",
          "description": "The date of the date night event, stored as a string.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the date night event."
        },
        "activitySuggestionId": {
          "type": "string",
          "description": "Reference to the ActivitySuggestion used for this date night. (Relationship: ActivitySuggestion 1:N DateNight)"
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "description"
      ]
    },
    "ActivitySuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ActivitySuggestion",
      "type": "object",
      "description": "Represents an activity suggestion generated by the AI model.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the activity suggestion."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the activity suggestion."
        },
        "restaurantPreference": {
          "type": "string",
          "description": "Preference for restaurant type."
        },
        "cuisinePreference": {
          "type": "string",
          "description": "Preferred cuisine for the activity."
        },
        "activityType": {
          "type": "string",
          "description": "The type of activity being suggested."
        }
      },
      "required": [
        "id",
        "description"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the Forever Us application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dateNights/{dateNightId}",
        "definition": {
          "entityName": "DateNight",
          "schema": {
            "$ref": "#/backend/entities/DateNight"
          },
          "description": "Stores date night events scheduled by a user. Path-based ownership guarantees that only the user can access date nights under their user ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "dateNightId",
              "description": "The unique identifier for the date night event."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chatMessages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages sent by a user. Path-based ownership guarantees that only the user can access chat messages under their user ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "chatMessageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/activitySuggestions/{activitySuggestionId}",
        "definition": {
          "entityName": "ActivitySuggestion",
          "schema": {
            "$ref": "#/backend/entities/ActivitySuggestion"
          },
          "description": "Stores activity suggestions generated by the AI model. These are globally accessible.",
          "params": [
            {
              "name": "activitySuggestionId",
              "description": "The unique identifier for the activity suggestion."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the 'Forever Us' application, focusing on ease of use, scalability, and secure access. It prioritizes Authorization Independence by denormalizing authorization data and leverages Structural Segregation to maintain a homogeneous security posture within each collection.  Path-based ownership is employed where applicable to ensure simple and efficient security rules. This design enables secure `list` operations (QAPs) by segregating data with differing access requirements into separate collections.\n\nAuthorization Independence:\n*   User data is stored directly under `/users/{userId}`.  Since other entities are user-owned (DateNight, ChatMessage), these are nested under `/users/{userId}`.\n\nQAPs Support:\n*   Segregation: Data is segregated based on ownership. User-specific data (DateNights, ChatMessages) are stored under their respective user documents, allowing secure listing based on `request.auth.uid`.\n\nThis structure avoids hierarchical authorization dependencies, simplifies security rules, and supports atomic operations. It also allows for easier debugging and maintenance."
  }
}